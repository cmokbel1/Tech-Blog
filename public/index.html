<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tech-Blog</title>
  <link rel="resetStylesheet" href="../css/reset.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Blog about IT</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText"
        aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="./index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./profile.html">Dashboard</a>
          </li>
        </ul>
        <a class="navbar-text" href="signIn.html">
          Sign In
        </a>
      </div>
    </div>
  </nav>
  <div id="aboutProject">
    This Project was developed as a means for registered users to have the opportunity to blog about tech related
    topics, view other users blog posts andcomment on those posts that compel them to do so. This project was
    developed as a part of the UCI 3 month full stack web development bootcamp at the close of year 2021, and start of
    year 2022.
    <br>
    <br>
    This project features Object Relational Mapping. There are many files, which can be overwhelming but in order to
    keep a separation of concerns, we must separate the functionality into multiple components, and then export/import
    those files into different files for reference and functionality.
    <br><br>
    To sign up one need only to click the sign-up tab located in the navigation bar, or click <a
      href="signUp.html">here</a>. Sign up with an e-mail, username, and password. This project uses the passport NPM
    package that allows for sequelizing of a hash, encrypting and protecting a user password, leaving the account
    system un-hackable.
  </div>
  <br>
  <br>
  <hr>
  <br>
  <br>
  <span style="font-weight:700; font-size:xx-large;">Create a Post</span>
  <br>
  <br>
  <div id="container">
      <form>
        <div class="mb-6">
          <label for="title" class="form-label" style="font-size:x-large">Title</label>
          <br>
          <br>
          <input type="text" class="form-control" id="title">
        </div>
        <div class="mb-6">
          <label for="body" class="form-label" style="font-size:x-large">Body</label>
          <br>
          <br>
          <textarea class="form-control" name="body" id="body" cols="30" rows="10"></textarea>
        </div>
        <button id="post" type="submit" class="btn btn-primary">Create Post</button>
      </form>
  </div>
  <div id="postContainer" class="container"></div>


  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <script>
    function createPost() {
      let newPost = {
        title: document.getElementById('title').value,
        body: document.getElementById('body').value
      }
      axios.post('/api/posts', newPost, {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      })
        .then(res => {
          console.log(res)
        })
    }

    document.getElementById('post').addEventListener('click', event => {
      event.preventDefault()
      createPost()
    })

    axios.get('/api/posts', {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      }
    })
      .then(res => {
        console.log(res.data)
        let posts = res.data
        posts.forEach(post => {
          let postElem = document.createElement('div')
          postElem.innerHTML = `
        <h3 class = "posted" data-postid = "${post.id}"> ${post.title} </h3>
        <h5> posted by ${post.User.username}</h5>
        <p> ${post.body}</p>
        `
          document.getElementById('postContainer').prepend(postElem)
        })
      })

    document.addEventListener('click', event => {
      if (event.target.classList.contains('posted')) {
        console.log('ping')
        localStorage.setItem('postId', event.target.dataset.postid)
        location = '/post.html'
      }
    })

    async function logOut() {
      localStorage.removeItem('username')
      localStorage.removeItem('token')
      location = '/public/index.html'
    }

    // document.getElementById('signout').addEventListener('click', event => {
    //   event.preventDefault()
    //   logOut()
    // })

    createPost();
  </script>
</body>

</html>